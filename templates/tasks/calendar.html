{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Vista de Calendario - TaskMaster</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        :root {
            --primary: #4361ee;
            --primary-dark: #3649c8;
            --muted: #666;
            --bg: #eef1f7;
            --card-bg: #ffffff;
            --danger: #e63946;
            --warning: #fca311;
        }

        body {
            font-family: 'Segoe UI', Roboto, sans-serif;
            background: var(--bg);
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background: white;
            padding: 1.5rem 3rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }

        header h1 {
            color: var(--primary);
            margin: 0;
        }

        header a {
            text-decoration: none;
            color: var(--muted);
            font-weight: 600;
        }

        main {
            flex: 1;
            max-width: 800px;
            margin: 2rem auto;
            width: 92%;
        }

        .frame {
            background: white;
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 4px 16px rgba(0,0,0,0.10);
        }

        .screen-title {
            text-align: center;
            font-size: 1.6rem;
            font-weight: 700;
            color: var(--primary);
        }

        .status-bar {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: .9rem;
            color: var(--muted);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.3rem;
            margin: 1rem 0;
        }

        .calendar-header span {
            font-weight: 700;
        }

        .calendar-header button {
            border: none;
            background: var(--primary);
            color: white;
            padding: 8px 14px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
        }

        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .calendar-day {
            background: white;
            padding: 12px;
            text-align: center;
            border-radius: 10px;
            min-height: 48px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--muted);
            font-weight: 600;
            cursor: pointer;
        }

        .calendar-day.header {
            color: var(--primary-dark);
            font-weight: 700;
            cursor: default;
        }

        .current {
            background: var(--primary);
            color: white;
            font-weight: 700;
            box-shadow: 0 4px 10px rgba(67,97,238,0.4);
        }

        .task-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            margin-top: 4px;
        }

        .task-dot-alta { background: #e63946; }
        .task-dot-media { background: #fca311; }
        .task-dot-baja { background: #4361ee; }

        .task-list {
            margin-top: 20px;
        }

        .task-item {
            background: white;
            padding: 1rem;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 12px;
        }

        .task-item.high-priority {
            border-left: 5px solid var(--danger);
        }

        .task-item.medium-priority {
            border-left: 5px solid var(--warning);
        }

        /* Pills */
        .priority-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            color: white;
            margin-bottom: 6px;
        }

        .priority-alta { background: #e63946; }
        .priority-media { background: #fca311; }
        .priority-baja { background: #4361ee; }

        footer {
            background: white;
            padding: 1rem;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
        }

        .nav-bar {
            display: flex;
            justify-content: center;
            gap: 3rem;
        }

        .nav-item {
            font-size: 1.7rem;
            color: var(--muted);
            cursor: pointer;
        }

        .nav-item.active {
            color: var(--primary);
        }
    </style>
</head>

<body>

<header>
    <h1>TaskMaster</h1>
    <a href="{% url 'dashboard' %}">‚Üê Volver</a>
</header>

<main>
    <div class="frame">

        <div class="screen-title">Vista de Calendario</div>

        <div class="status-bar">
            <span>{{ request.user.email }}</span>
            <span>üì∂</span>
        </div>

        <!-- ENCABEZADO DEL MES -->
        <div class="calendar-header">
            <button onclick="window.location.href='?month={{ month|add:-1 }}&year={{ year }}'">‚Üê</button>
            <span>{{ month_name }} {{ year }}</span>
            <button onclick="window.location.href='?month={{ month|add:1 }}&year={{ year }}'">‚Üí</button>
        </div>

        <!-- ENCABEZADOS DE D√çAS -->
        <div class="calendar">
            <div class="calendar-day header">Dom</div>
            <div class="calendar-day header">Lun</div>
            <div class="calendar-day header">Mar</div>
            <div class="calendar-day header">Mi√©</div>
            <div class="calendar-day header">Jue</div>
            <div class="calendar-day header">Vie</div>
            <div class="calendar-day header">S√°b</div>

            <!-- GRID GENERADO POR DJANGO -->
            {% for week in calendar %}
                {% for day in week %}
                    {% if day == 0 %}
                        <div class="calendar-day"></div>

                    {% else %}

                        {% with day_classes="calendar-day" %}
                            {% if selected_date.day == day %}
                                {% with day_classes=day_classes|add:" current" %}
                                {% endwith %}
                            {% endif %}

                            <div class="{{ day_classes }}"
                                 onclick="window.location.href='?day={{day}}&month={{month}}&year={{year}}'">

                                {{ day }}

                                {% if day in tasks_by_priority %}
                                    {% if tasks_by_priority.day == "Alta" %}
                                        <div class="task-dot task-dot-alta"></div>
                                    {% elif tasks_by_priority.day == "Media" %}
                                        <div class="task-dot task-dot-media"></div>
                                    {% else %}
                                        <div class="task-dot task-dot-baja"></div>
                                    {% endif %}
                                {% endif %}

                            </div>

                        {% endwith %}

                    {% endif %}
                {% endfor %}
            {% endfor %}
        </div>

        <!-- LISTA DE TAREAS REAL -->
        <div class="task-list">
            <h4>Tareas del {{ selected_date|date:"d M" }}</h4>

            {% for task in tasks_selected_day %}
                <div class="task-item 
                    {% if task.priority == 'Alta' %}high-priority
                    {% elif task.priority == 'Media' %}medium-priority
                    {% endif %}">
                    
                    <span class="priority-badge
                        {% if task.priority == 'Alta' %}priority-alta
                        {% elif task.priority == 'Media' %}priority-media
                        {% else %}priority-baja{% endif %}">
                        {{ task.priority }}
                    </span>

                    <div style="margin-top: 6px;">
                        <strong>{{ task.title }}</strong>
                    </div>

                    <div style="color:#666; font-size: 14px; margin-top: 4px;">
                        {{ task.time|time:"g:i A" }} ‚Äî {{ task.description|default:"Sin descripci√≥n" }}
                    </div>
                </div>
            {% empty %}
                <p style="color:#777; margin-top:10px;">No tienes tareas este d√≠a.</p>
            {% endfor %}
        </div>

    </div>
</main>

<footer>
    <div class="nav-bar">
        <div class="nav-item" onclick="window.location.href='{% url 'dashboard' %}'">üè†</div>
        <div class="nav-item active">üìÖ</div>
        <div class="nav-item" onclick="window.location.href='{% url 'create_task' %}'">‚ûï</div>
        <div class="nav-item">üîî</div>
        <div class="nav-item" onclick="window.location.href='{% url 'edit_profile' %}'">üë§</div>
    </div>
</footer>

</body>
</html>
